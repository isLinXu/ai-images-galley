<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæ™ºèƒ½ç›¸å†Œç³»ç»Ÿ</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
        
        :root {
            --primary-color: #3B82F6;
            --secondary-color: #10B981;
            --accent-color: #F59E0B;
            --background-color: rgba(255, 255, 255, 0.95);
            --surface-color: rgba(255, 255, 255, 0.9);
            --text-color: #1F2937;
            --text-secondary: #6B7280;
            --border-color: #E5E7EB;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-color);
        }

        .glass-effect {
            backdrop-filter: blur(10px);
            background: var(--surface-color);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .text-with-shadow {
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .high-contrast-text {
            color: #000 !important;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
        }

        .high-contrast-text-light {
            color: #fff !important;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        .ai-badge {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .confidence-bar {
            background: linear-gradient(90deg, #10B981 0%, #F59E0B 50%, #EF4444 100%);
            height: 4px;
            border-radius: 2px;
            overflow: hidden;
        }

        .tag-item {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            font-weight: 500;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .image-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
        }

        .image-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            border-color: var(--primary-color);
        }

        .ai-analysis-preview {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(16, 185, 129, 0.9));
            backdrop-filter: blur(8px);
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .modal-overlay {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
        }

        .theme-btn {
            background: var(--surface-color);
            border: 2px solid var(--border-color);
            color: var(--text-color);
            font-weight: 600;
            transition: all 0.2s;
        }

        .theme-btn:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .admin-btn {
            background: linear-gradient(45deg, #EF4444, #F59E0B);
            color: white;
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .gradient-text {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }

        /* é«˜å¯¹æ¯”åº¦ä¸»é¢˜ */
        .dark-theme {
            --background-color: rgba(17, 24, 39, 0.95);
            --surface-color: rgba(31, 41, 55, 0.9);
            --text-color: #F9FAFB;
            --text-secondary: #D1D5DB;
            --border-color: #374151;
        }

        .dark-theme .high-contrast-text {
            color: #F9FAFB !important;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .grid-responsive {
                grid-template-columns: 1fr;
            }
            
            .text-responsive {
                font-size: 0.875rem;
            }
        }

        @media (min-width: 768px) {
            .grid-responsive {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .grid-responsive {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (min-width: 1280px) {
            .grid-responsive {
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- ä¸»å¯¼èˆªæ  -->
    <nav class="glass-effect sticky top-0 z-50 border-b border-white/20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4">
                    <h1 class="text-2xl font-bold gradient-text">
                        <i class="fas fa-brain mr-2"></i>AIæ™ºèƒ½ç›¸å†Œ
                    </h1>
                    <span class="ai-badge px-3 py-1 rounded-full text-sm">
                        <i class="fas fa-robot mr-1"></i>æ™ºèƒ½åˆ†æ
                    </span>
                </div>
                
                <div class="flex items-center space-x-3">
                    <!-- ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
                    <button id="theme-toggle" class="theme-btn px-4 py-2 rounded-lg">
                        <i class="fas fa-palette mr-2"></i>ä¸»é¢˜
                    </button>
                    
                    <!-- ç”¨æˆ·çŠ¶æ€ -->
                    <div id="user-status" class="flex items-center space-x-2">
                        <span class="high-contrast-text font-medium">æ¸¸å®¢æ¨¡å¼</span>
                        <button id="admin-login-btn" class="theme-btn px-4 py-2 rounded-lg">
                            <i class="fas fa-sign-in-alt mr-2"></i>ç®¡ç†å‘˜ç™»å½•
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- åŠŸèƒ½å¯¼èˆª -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
        <div class="glass-effect rounded-xl p-4">
            <div class="flex flex-wrap gap-3 justify-center">
                <button onclick="showTab('gallery')" class="tab-btn theme-btn px-6 py-3 rounded-lg active">
                    <i class="fas fa-images mr-2"></i>å›¾ç‰‡æµè§ˆ
                </button>
                <button onclick="showTab('ai-analysis')" class="tab-btn theme-btn px-6 py-3 rounded-lg">
                    <i class="fas fa-brain mr-2"></i>AIåˆ†æ
                </button>
                <button onclick="showTab('galleries')" class="tab-btn theme-btn px-6 py-3 rounded-lg">
                    <i class="fas fa-folder mr-2"></i>ç”»å»Šç®¡ç†
                </button>
                <button onclick="showTab('upload')" class="tab-btn admin-only theme-btn px-6 py-3 rounded-lg" style="display: none;">
                    <i class="fas fa-upload mr-2"></i>ä¸Šä¼ ç®¡ç†
                </button>
                <button onclick="showTab('settings')" class="tab-btn theme-btn px-6 py-3 rounded-lg">
                    <i class="fas fa-cog mr-2"></i>è®¾ç½®
                </button>
            </div>
        </div>
    </div>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-8">
        <!-- å›¾ç‰‡æµè§ˆæ ‡ç­¾é¡µ -->
        <div id="gallery-tab" class="tab-content">
            <!-- æœç´¢å’Œè¿‡æ»¤ -->
            <div class="glass-effect rounded-xl p-6 mb-6">
                <div class="flex flex-col lg:flex-row gap-4">
                    <div class="flex-1">
                        <input type="text" id="search-input" placeholder="ğŸ” æœç´¢å›¾ç‰‡ã€æ ‡ç­¾æˆ–æè¿°..." 
                               class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:outline-none high-contrast-text bg-white/90">
                    </div>
                    <div class="flex gap-3">
                        <select id="tag-filter" class="px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:outline-none high-contrast-text bg-white/90">
                            <option value="">æ‰€æœ‰æ ‡ç­¾</option>
                        </select>
                        <select id="sort-option" class="px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:outline-none high-contrast-text bg-white/90">
                            <option value="newest">æœ€æ–°</option>
                            <option value="oldest">æœ€æ—§</option>
                            <option value="name">åç§°</option>
                            <option value="ai-score">AIè¯„åˆ†</option>
                        </select>
                        <button onclick="refreshGallery()" class="theme-btn px-6 py-3 rounded-lg">
                            <i class="fas fa-sync-alt mr-2"></i>åˆ·æ–°
                        </button>
                    </div>
                </div>
            </div>

            <!-- åŠ è½½çŠ¶æ€ -->
            <div id="loading-indicator" class="glass-effect rounded-xl p-8 text-center">
                <div class="loading-spinner mx-auto mb-4"></div>
                <p class="high-contrast-text text-lg font-medium">æ­£åœ¨åŠ è½½å›¾ç‰‡å’ŒAIåˆ†æ...</p>
            </div>

            <!-- å›¾ç‰‡ç½‘æ ¼ -->
            <div id="images-grid" class="grid grid-responsive gap-6" style="display: none;">
                <!-- å›¾ç‰‡å¡ç‰‡å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>

            <!-- æ— å›¾ç‰‡æç¤º -->
            <div id="no-images" class="glass-effect rounded-xl p-12 text-center" style="display: none;">
                <i class="fas fa-images text-6xl text-gray-400 mb-4"></i>
                <h3 class="high-contrast-text text-xl font-semibold mb-2">æš‚æ— å›¾ç‰‡</h3>
                <p class="high-contrast-text opacity-75">è¯·å°†å›¾ç‰‡æ·»åŠ åˆ° images æ–‡ä»¶å¤¹æˆ–é€šè¿‡ç®¡ç†å‘˜ä¸Šä¼ </p>
            </div>
        </div>

        <!-- AIåˆ†ææ ‡ç­¾é¡µ -->
        <div id="ai-analysis-tab" class="tab-content hidden">
            <div class="glass-effect rounded-xl p-6">
                <h2 class="text-2xl font-bold high-contrast-text mb-6">
                    <i class="fas fa-brain mr-3"></i>AIåˆ†æç»Ÿè®¡
                </h2>
                
                <div class="grid md:grid-cols-3 gap-6 mb-8">
                    <div class="glass-effect rounded-xl p-6 text-center">
                        <i class="fas fa-eye text-4xl text-blue-500 mb-3"></i>
                        <h3 class="high-contrast-text text-lg font-semibold">æ£€æµ‹åˆ°çš„ç‰©ä½“</h3>
                        <p id="objects-count" class="text-3xl font-bold text-blue-500">0</p>
                    </div>
                    <div class="glass-effect rounded-xl p-6 text-center">
                        <i class="fas fa-landscape text-4xl text-green-500 mb-3"></i>
                        <h3 class="high-contrast-text text-lg font-semibold">åœºæ™¯ç±»å‹</h3>
                        <p id="scenes-count" class="text-3xl font-bold text-green-500">0</p>
                    </div>
                    <div class="glass-effect rounded-xl p-6 text-center">
                        <i class="fas fa-tags text-4xl text-yellow-500 mb-3"></i>
                        <h3 class="high-contrast-text text-lg font-semibold">è‡ªåŠ¨æ ‡ç­¾</h3>
                        <p id="tags-count" class="text-3xl font-bold text-yellow-500">0</p>
                    </div>
                </div>

                <div id="ai-analysis-details" class="space-y-6">
                    <!-- AIåˆ†æè¯¦æƒ…å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
        </div>

        <!-- å…¶ä»–æ ‡ç­¾é¡µå†…å®¹ -->
        <div id="galleries-tab" class="tab-content hidden">
            <div class="glass-effect rounded-xl p-6">
                <h2 class="text-2xl font-bold high-contrast-text mb-6">
                    <i class="fas fa-folder mr-3"></i>ç”»å»Šç®¡ç†
                </h2>
                <p class="high-contrast-text">ç”»å»Šç®¡ç†åŠŸèƒ½å¼€å‘ä¸­...</p>
            </div>
        </div>

        <div id="upload-tab" class="tab-content hidden">
            <div class="glass-effect rounded-xl p-6">
                <h2 class="text-2xl font-bold high-contrast-text mb-6">
                    <i class="fas fa-upload mr-3"></i>ä¸Šä¼ ç®¡ç†
                </h2>
                <p class="high-contrast-text">ä¸Šä¼ ç®¡ç†åŠŸèƒ½å¼€å‘ä¸­...</p>
            </div>
        </div>

        <div id="settings-tab" class="tab-content hidden">
            <div class="glass-effect rounded-xl p-6">
                <h2 class="text-2xl font-bold high-contrast-text mb-6">
                    <i class="fas fa-cog mr-3"></i>ç³»ç»Ÿè®¾ç½®
                </h2>
                <div class="space-y-6">
                    <!-- ä¸»é¢˜è®¾ç½® -->
                    <div>
                        <h3 class="high-contrast-text text-lg font-semibold mb-4">ä¸»é¢˜è®¾ç½®</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="theme-options">
                            <!-- ä¸»é¢˜é€‰é¡¹å°†åœ¨è¿™é‡Œç”Ÿæˆ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- å›¾ç‰‡è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="image-detail-modal" class="fixed inset-0 modal-overlay z-50 hidden flex items-center justify-center p-4">
        <div class="glass-effect rounded-2xl max-w-6xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 id="modal-title" class="text-2xl font-bold high-contrast-text">å›¾ç‰‡è¯¦æƒ…</h2>
                    <button onclick="closeImageModal()" class="text-gray-500 hover:text-gray-700 text-2xl">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="grid lg:grid-cols-2 gap-8">
                    <!-- å·¦ä¾§ï¼šå›¾ç‰‡æ˜¾ç¤º -->
                    <div>
                        <img id="modal-image" class="w-full h-auto rounded-xl shadow-lg" alt="">
                        <div class="mt-4 text-center">
                            <button onclick="downloadCurrentImage()" class="theme-btn px-6 py-3 rounded-lg mr-3">
                                <i class="fas fa-download mr-2"></i>ä¸‹è½½
                            </button>
                            <button onclick="shareCurrentImage()" class="theme-btn px-6 py-3 rounded-lg">
                                <i class="fas fa-share mr-2"></i>åˆ†äº«
                            </button>
                        </div>
                    </div>
                    
                    <!-- å³ä¾§ï¼šè¯¦ç»†ä¿¡æ¯ -->
                    <div class="space-y-6">
                        <!-- AIåˆ†æç»“æœ -->
                        <div>
                            <h3 class="high-contrast-text text-lg font-semibold mb-4">
                                <i class="fas fa-brain mr-2"></i>AIåˆ†æç»“æœ
                            </h3>
                            <div id="modal-ai-analysis" class="space-y-4">
                                <!-- AIåˆ†æç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                            </div>
                        </div>
                        
                        <!-- æ ‡ç­¾ -->
                        <div>
                            <h3 class="high-contrast-text text-lg font-semibold mb-4">
                                <i class="fas fa-tags mr-2"></i>æ ‡ç­¾
                            </h3>
                            <div id="modal-tags" class="flex flex-wrap gap-2 mb-4">
                                <!-- æ ‡ç­¾å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                            </div>
                            <div class="admin-only" style="display: none;">
                                <input type="text" id="new-tag-input" placeholder="æ·»åŠ æ–°æ ‡ç­¾..." 
                                       class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-blue-500 focus:outline-none high-contrast-text bg-white/90"
                                       onkeypress="handleTagInput(event)">
                            </div>
                        </div>
                        
                        <!-- æè¿° -->
                        <div>
                            <h3 class="high-contrast-text text-lg font-semibold mb-4">
                                <i class="fas fa-align-left mr-2"></i>æè¿°
                            </h3>
                            <textarea id="modal-description" rows="4" placeholder="å›¾ç‰‡æè¿°..." 
                                      class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-blue-500 focus:outline-none high-contrast-text bg-white/90 resize-none"
                                      readonly></textarea>
                            <div class="admin-only mt-2" style="display: none;">
                                <button onclick="saveImageDescription()" class="admin-btn px-4 py-2 rounded-lg">
                                    <i class="fas fa-save mr-2"></i>ä¿å­˜æè¿°
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ç®¡ç†å‘˜ç™»å½•æ¨¡æ€æ¡† -->
    <div id="admin-login-modal" class="fixed inset-0 modal-overlay z-50 hidden flex items-center justify-center p-4">
        <div class="glass-effect rounded-2xl max-w-md w-full p-6">
            <h2 class="text-2xl font-bold high-contrast-text mb-6 text-center">
                <i class="fas fa-key mr-2"></i>ç®¡ç†å‘˜ç™»å½•
            </h2>
            <form onsubmit="handleAdminLogin(event)">
                <div class="mb-4">
                    <label class="block high-contrast-text text-sm font-semibold mb-2">GitHub Personal Access Token:</label>
                    <input type="password" id="github-token" placeholder="è¾“å…¥æ‚¨çš„GitHub Token..." 
                           class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-blue-500 focus:outline-none high-contrast-text bg-white/90"
                           required>
                </div>
                <div class="flex gap-3">
                    <button type="submit" class="flex-1 admin-btn px-6 py-3 rounded-lg font-semibold">
                        <i class="fas fa-sign-in-alt mr-2"></i>ç™»å½•
                    </button>
                    <button type="button" onclick="closeAdminModal()" class="flex-1 theme-btn px-6 py-3 rounded-lg">
                        å–æ¶ˆ
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentImages = [];
        let isAdmin = false;
        let currentImageIndex = 0;
        let aiAnalysisResults = new Map();
        let themeSettings = {
            background: 'default',
            uiTheme: 'light'
        };

        // AIåˆ†æå¼•æ“
        class AIAnalysisEngine {
            async analyzeImage(imageFile, imageElement) {
                console.log('ğŸ¤– å¼€å§‹AIåˆ†æ:', imageFile?.name || 'unknown');
                
                try {
                    const analysisResults = {
                        objects: await this.detectObjects(imageElement),
                        scenes: await this.classifyScene(imageElement),
                        emotions: await this.analyzeEmotions(imageElement),
                        colors: await this.extractColors(imageElement),
                        smartTags: [],
                        confidence: 0,
                        timestamp: Date.now()
                    };
                    
                    analysisResults.smartTags = this.generateSmartTags(analysisResults);
                    analysisResults.confidence = this.calculateOverallConfidence(analysisResults);
                    
                    console.log('âœ… AIåˆ†æå®Œæˆ:', analysisResults);
                    return analysisResults;
                } catch (error) {
                    console.error('AIåˆ†æå¤±è´¥:', error);
                    return this.getDefaultAnalysis();
                }
            }

            async detectObjects(imageElement) {
                if (!imageElement) return [];
                
                try {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = imageElement.naturalWidth || 400;
                    canvas.height = imageElement.naturalHeight || 300;
                    ctx.drawImage(imageElement, 0, 0);
                    
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const brightness = this.calculateBrightness(imageData);
                    const colorDistribution = this.analyzeColorDistribution(imageData);
                    
                    const detectedObjects = [];
                    
                    if (brightness > 150) {
                        detectedObjects.push({ label: 'æ˜äº®åœºæ™¯', confidence: 0.85, category: 'environment' });
                        detectedObjects.push({ label: 'æˆ·å¤–', confidence: 0.75, category: 'location' });
                    } else if (brightness < 80) {
                        detectedObjects.push({ label: 'å®¤å†…', confidence: 0.80, category: 'location' });
                        detectedObjects.push({ label: 'å¤œæ™¯', confidence: 0.70, category: 'time' });
                    }
                    
                    if (colorDistribution.green > 0.3) {
                        detectedObjects.push({ label: 'æ¤ç‰©', confidence: 0.82, category: 'nature' });
                        detectedObjects.push({ label: 'è‡ªç„¶', confidence: 0.78, category: 'scene' });
                    }
                    
                    if (colorDistribution.blue > 0.25) {
                        detectedObjects.push({ label: 'å¤©ç©º', confidence: 0.85, category: 'nature' });
                        detectedObjects.push({ label: 'æ°´ä½“', confidence: 0.65, category: 'nature' });
                    }
                    
                    if (colorDistribution.skin > 0.15) {
                        detectedObjects.push({ label: 'äººç‰©', confidence: 0.88, category: 'person' });
                        detectedObjects.push({ label: 'è‚–åƒ', confidence: 0.72, category: 'style' });
                    }
                    
                    return detectedObjects;
                } catch (error) {
                    return [{ label: 'æœªçŸ¥ç‰©ä½“', confidence: 0.5, category: 'unknown' }];
                }
            }

            async classifyScene(imageElement) {
                if (!imageElement) return [];
                
                const scenes = [];
                try {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = imageElement.naturalWidth || 400;
                    canvas.height = imageElement.naturalHeight || 300;
                    ctx.drawImage(imageElement, 0, 0);
                    
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const brightness = this.calculateBrightness(imageData);
                    const contrast = this.calculateContrast(imageData);
                    const colorComplexity = this.calculateColorComplexity(imageData);
                    
                    if (brightness > 140 && colorComplexity > 0.6) {
                        scenes.push({ label: 'æˆ·å¤–é£æ™¯', confidence: 0.87 });
                        scenes.push({ label: 'è‡ªç„¶æ™¯è§‚', confidence: 0.82 });
                    }
                    
                    if (contrast > 50 && brightness < 100) {
                        scenes.push({ label: 'å®¤å†…æ‹æ‘„', confidence: 0.78 });
                        scenes.push({ label: 'äººå·¥ç…§æ˜', confidence: 0.70 });
                    }
                    
                    if (colorComplexity < 0.3) {
                        scenes.push({ label: 'ç®€çº¦é£æ ¼', confidence: 0.75 });
                    }
                    
                    return scenes;
                } catch (error) {
                    return [{ label: 'æœªçŸ¥åœºæ™¯', confidence: 0.50 }];
                }
            }

            async analyzeEmotions(imageElement) {
                if (!imageElement) return [];
                
                try {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = imageElement.naturalWidth || 400;
                    canvas.height = imageElement.naturalHeight || 300;
                    ctx.drawImage(imageElement, 0, 0);
                    
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const colorTone = this.analyzeColorTone(imageData);
                    const brightness = this.calculateBrightness(imageData);
                    
                    const emotions = [];
                    
                    if (colorTone.warm > 0.6 && brightness > 120) {
                        emotions.push({ label: 'å¿«ä¹', confidence: 0.82, color: '#FFD700' });
                        emotions.push({ label: 'æ¸©æš–', confidence: 0.78, color: '#FF6B35' });
                    }
                    
                    if (colorTone.cool > 0.6) {
                        emotions.push({ label: 'å¹³é™', confidence: 0.75, color: '#4A90E2' });
                        emotions.push({ label: 'å®é™', confidence: 0.70, color: '#5DADE2' });
                    }
                    
                    if (brightness < 80) {
                        emotions.push({ label: 'ç¥ç§˜', confidence: 0.68, color: '#6C5CE7' });
                    }
                    
                    return emotions;
                } catch (error) {
                    return [{ label: 'ä¸­æ€§', confidence: 0.60, color: '#95A5A6' }];
                }
            }

            async extractColors(imageElement) {
                if (!imageElement) return [];
                
                try {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = imageElement.naturalWidth || 400;
                    canvas.height = imageElement.naturalHeight || 300;
                    ctx.drawImage(imageElement, 0, 0);
                    
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const data = imageData.data;
                    const colorCounts = {};
                    
                    for (let i = 0; i < data.length; i += 16) {
                        const r = Math.round(data[i] / 32) * 32;
                        const g = Math.round(data[i + 1] / 32) * 32;
                        const b = Math.round(data[i + 2] / 32) * 32;
                        const key = `${r},${g},${b}`;
                        
                        colorCounts[key] = (colorCounts[key] || 0) + 1;
                    }
                    
                    const dominantColors = Object.entries(colorCounts)
                        .sort(([,a], [,b]) => b - a)
                        .slice(0, 5)
                        .map(([rgb, count]) => {
                            const [r, g, b] = rgb.split(',').map(Number);
                            return {
                                rgb: `rgb(${r},${g},${b})`,
                                hex: this.rgbToHex(r, g, b),
                                count: count,
                                percentage: Math.round((count / (data.length / 4)) * 100),
                                name: this.getColorName(r, g, b),
                                brightness: Math.round((r + g + b) / 3)
                            };
                        });
                    
                    return dominantColors;
                } catch (error) {
                    return [];
                }
            }

            generateSmartTags(analysisResults) {
                const tags = new Set();
                
                analysisResults.objects.forEach(obj => {
                    if (obj.confidence > 0.65) {
                        tags.add(obj.label);
                    }
                });
                
                analysisResults.scenes.forEach(scene => {
                    if (scene.confidence > 0.70) {
                        tags.add(scene.label);
                    }
                });
                
                if (analysisResults.emotions.length > 0) {
                    const dominantEmotion = analysisResults.emotions[0];
                    if (dominantEmotion.confidence > 0.60) {
                        tags.add(dominantEmotion.label);
                    }
                }
                
                if (analysisResults.colors.length > 0) {
                    const dominantColor = analysisResults.colors[0];
                    tags.add(dominantColor.name);
                }
                
                return Array.from(tags);
            }

            // è¾…åŠ©å‡½æ•°
            calculateBrightness(imageData) {
                const data = imageData.data;
                let sum = 0;
                for (let i = 0; i < data.length; i += 4) {
                    sum += (data[i] + data[i + 1] + data[i + 2]) / 3;
                }
                return sum / (data.length / 4);
            }

            calculateContrast(imageData) {
                const data = imageData.data;
                const values = [];
                for (let i = 0; i < data.length; i += 4) {
                    values.push((data[i] + data[i + 1] + data[i + 2]) / 3);
                }
                
                const mean = values.reduce((a, b) => a + b) / values.length;
                const variance = values.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / values.length;
                return Math.sqrt(variance);
            }

            calculateColorComplexity(imageData) {
                const data = imageData.data;
                const colors = new Set();
                for (let i = 0; i < data.length; i += 16) {
                    const r = Math.round(data[i] / 64) * 64;
                    const g = Math.round(data[i + 1] / 64) * 64;
                    const b = Math.round(data[i + 2] / 64) * 64;
                    colors.add(`${r},${g},${b}`);
                }
                return colors.size / 64; // å½’ä¸€åŒ–
            }

            analyzeColorDistribution(imageData) {
                const data = imageData.data;
                let green = 0, blue = 0, skin = 0, total = 0;
                
                for (let i = 0; i < data.length; i += 4) {
                    const r = data[i];
                    const g = data[i + 1];
                    const b = data[i + 2];
                    
                    if (g > r && g > b && g > 100) green++;
                    if (b > r && b > g && b > 100) blue++;
                    if (r > 95 && g > 40 && b > 20 && r > g && r > b) skin++;
                    total++;
                }
                
                return {
                    green: green / total,
                    blue: blue / total,
                    skin: skin / total
                };
            }

            analyzeColorTone(imageData) {
                const data = imageData.data;
                let warm = 0, cool = 0, vibrant = 0, total = 0;
                
                for (let i = 0; i < data.length; i += 4) {
                    const r = data[i];
                    const g = data[i + 1];
                    const b = data[i + 2];
                    
                    if (r > b) warm++;
                    if (b > r) cool++;
                    if (Math.max(r, g, b) - Math.min(r, g, b) > 100) vibrant++;
                    total++;
                }
                
                return {
                    warm: warm / total,
                    cool: cool / total,
                    vibrant: vibrant / total
                };
            }

            rgbToHex(r, g, b) {
                return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
            }

            getColorName(r, g, b) {
                const colorNames = {
                    red: [255, 0, 0],
                    green: [0, 255, 0],
                    blue: [0, 0, 255],
                    yellow: [255, 255, 0],
                    purple: [128, 0, 128],
                    orange: [255, 165, 0],
                    pink: [255, 192, 203],
                    brown: [165, 42, 42],
                    black: [0, 0, 0],
                    white: [255, 255, 255],
                    gray: [128, 128, 128]
                };
                
                let closestColor = 'unknown';
                let minDistance = Infinity;
                
                for (const [name, [cr, cg, cb]] of Object.entries(colorNames)) {
                    const distance = Math.sqrt(Math.pow(r - cr, 2) + Math.pow(g - cg, 2) + Math.pow(b - cb, 2));
                    if (distance < minDistance) {
                        minDistance = distance;
                        closestColor = name;
                    }
                }
                
                return closestColor;
            }

            calculateOverallConfidence(results) {
                const confidences = [
                    ...results.objects.map(o => o.confidence),
                    ...results.scenes.map(s => s.confidence),
                    ...results.emotions.map(e => e.confidence)
                ];
                
                return confidences.length > 0 ? 
                    confidences.reduce((a, b) => a + b) / confidences.length : 0;
            }

            getDefaultAnalysis() {
                return {
                    objects: [{ label: 'æœªçŸ¥ç‰©ä½“', confidence: 0.5, category: 'unknown' }],
                    scenes: [{ label: 'æœªçŸ¥åœºæ™¯', confidence: 0.5 }],
                    emotions: [{ label: 'ä¸­æ€§', confidence: 0.5, color: '#95A5A6' }],
                    colors: [],
                    smartTags: ['å›¾ç‰‡'],
                    confidence: 0.5,
                    timestamp: Date.now()
                };
            }
        }

        // å›¾ç‰‡åŠ è½½å™¨
        class ImageLoader {
            constructor() {
                this.aiEngine = new AIAnalysisEngine();
            }

            async loadAllImages() {
                console.log('ğŸ” å¼€å§‹æ‰«æå›¾ç‰‡...');
                
                const strategies = [
                    this.loadFromGitHubAPI(),
                    this.loadFromDirectoryIndex(),
                    this.loadWithProbing(),
                    this.loadExampleImages()
                ];
                
                const results = await Promise.allSettled(strategies);
                let allImages = [];
                
                results.forEach((result, index) => {
                    if (result.status === 'fulfilled' && result.value.length > 0) {
                        console.log(`ç­–ç•¥ ${index + 1} åŠ è½½äº† ${result.value.length} å¼ å›¾ç‰‡`);
                        allImages = allImages.concat(result.value);
                    }
                });
                
                // å»é‡
                const uniqueImages = this.removeDuplicates(allImages);
                console.log(`æ€»å…±åŠ è½½äº† ${uniqueImages.length} å¼ å›¾ç‰‡`);
                
                // è‡ªåŠ¨è¿›è¡ŒAIåˆ†æ
                await this.performAIAnalysis(uniqueImages);
                
                return uniqueImages;
            }

            async loadFromGitHubAPI() {
                try {
                    const response = await fetch('https://api.github.com/repos/isLinXu/ai-images-galley/contents/images');
                    if (!response.ok) throw new Error('GitHub APIè¯·æ±‚å¤±è´¥');
                    
                    const files = await response.json();
                    const imageFiles = files.filter(file => 
                        file.type === 'file' && 
                        /\.(jpg|jpeg|png|gif|webp|bmp|svg)$/i.test(file.name)
                    );
                    
                    return imageFiles.map(file => ({
                        id: file.sha,
                        name: file.name,
                        url: `images/${file.name}`,
                        downloadUrl: file.download_url,
                        size: file.size,
                        loadMethod: 'GitHub API'
                    }));
                } catch (error) {
                    console.log('GitHub APIåŠ è½½å¤±è´¥ï¼Œå°è¯•å…¶ä»–æ–¹æ³•');
                    return [];
                }
            }

            async loadFromDirectoryIndex() {
                try {
                    const response = await fetch('images/');
                    if (!response.ok) throw new Error('ç›®å½•ç´¢å¼•ä¸å¯ç”¨');
                    
                    const html = await response.text();
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const links = doc.querySelectorAll('a[href]');
                    
                    const imageFiles = [];
                    links.forEach(link => {
                        const href = link.getAttribute('href');
                        if (href && /\.(jpg|jpeg|png|gif|webp|bmp|svg)$/i.test(href)) {
                            imageFiles.push({
                                id: href,
                                name: href,
                                url: `images/${href}`,
                                loadMethod: 'Directory Index'
                            });
                        }
                    });
                    
                    return imageFiles;
                } catch (error) {
                    console.log('ç›®å½•ç´¢å¼•åŠ è½½å¤±è´¥');
                    return [];
                }
            }

            async loadWithProbing() {
                const commonNames = [
                    'photo1.jpg', 'photo2.jpg', 'photo3.jpg', 'photo4.jpg', 'photo5.jpg',
                    'image1.png', 'image2.png', 'image3.png', 'image4.png', 'image5.png',
                    'pic1.jpg', 'pic2.jpg', 'pic3.jpg',
                    'test.jpg', 'sample.png', 'demo.jpg'
                ];
                
                const validImages = [];
                
                for (let i = 0; i < commonNames.length; i += 3) {
                    const batch = commonNames.slice(i, i + 3);
                    const results = await Promise.all(
                        batch.map(name => this.checkImageExists(name))
                    );
                    
                    results.forEach(result => {
                        if (result) validImages.push(result);
                    });
                }
                
                return validImages;
            }

            async loadExampleImages() {
                // ä½¿ç”¨ä¸€äº›åœ¨çº¿ç¤ºä¾‹å›¾ç‰‡ä½œä¸ºæ¼”ç¤º
                const exampleImages = [
                    {
                        id: 'example1',
                        name: 'ç¤ºä¾‹å›¾ç‰‡1.jpg',
                        url: 'https://picsum.photos/400/300?random=1',
                        loadMethod: 'åœ¨çº¿ç¤ºä¾‹'
                    },
                    {
                        id: 'example2',
                        name: 'ç¤ºä¾‹å›¾ç‰‡2.jpg',
                        url: 'https://picsum.photos/400/300?random=2',
                        loadMethod: 'åœ¨çº¿ç¤ºä¾‹'
                    },
                    {
                        id: 'example3',
                        name: 'ç¤ºä¾‹å›¾ç‰‡3.jpg',
                        url: 'https://picsum.photos/400/300?random=3',
                        loadMethod: 'åœ¨çº¿ç¤ºä¾‹'
                    },
                    {
                        id: 'example4',
                        name: 'ç¤ºä¾‹å›¾ç‰‡4.jpg',
                        url: 'https://picsum.photos/400/300?random=4',
                        loadMethod: 'åœ¨çº¿ç¤ºä¾‹'
                    }
                ];
                
                return exampleImages;
            }

            async checkImageExists(filename) {
                return new Promise((resolve) => {
                    const img = new Image();
                    img.onload = () => resolve({
                        id: filename,
                        name: filename,
                        url: `images/${filename}`,
                        loadMethod: 'æ–‡ä»¶æ¢æµ‹'
                    });
                    img.onerror = () => resolve(null);
                    img.src = `images/${filename}`;
                });
            }

            removeDuplicates(images) {
                const seen = new Set();
                return images.filter(img => {
                    if (seen.has(img.name)) return false;
                    seen.add(img.name);
                    return true;
                });
            }

            async performAIAnalysis(images) {
                console.log('ğŸ¤– å¼€å§‹æ‰¹é‡AIåˆ†æ...');
                
                for (const image of images) {
                    try {
                        // åˆ›å»ºå›¾ç‰‡å…ƒç´ è¿›è¡Œåˆ†æ
                        const imgElement = new Image();
                        imgElement.crossOrigin = 'anonymous';
                        
                        await new Promise((resolve, reject) => {
                            imgElement.onload = resolve;
                            imgElement.onerror = reject;
                            imgElement.src = image.url;
                        });
                        
                        // è¿›è¡ŒAIåˆ†æ
                        const analysis = await this.aiEngine.analyzeImage(null, imgElement);
                        aiAnalysisResults.set(image.id, analysis);
                        
                        console.log(`âœ… ${image.name} AIåˆ†æå®Œæˆ`);
                    } catch (error) {
                        console.warn(`âš ï¸ ${image.name} AIåˆ†æå¤±è´¥:`, error);
                        // è®¾ç½®é»˜è®¤åˆ†æç»“æœ
                        aiAnalysisResults.set(image.id, this.aiEngine.getDefaultAnalysis());
                    }
                }
                
                console.log(`ğŸ‰ æ‰¹é‡AIåˆ†æå®Œæˆï¼Œå…±åˆ†æ ${images.length} å¼ å›¾ç‰‡`);
            }
        }

        // åˆå§‹åŒ–åº”ç”¨
        const imageLoader = new ImageLoader();

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ğŸš€ åˆå§‹åŒ–AIæ™ºèƒ½ç›¸å†Œ...');
            
            // æ£€æŸ¥ç®¡ç†å‘˜çŠ¶æ€
            checkAdminStatus();
            
            // åˆå§‹åŒ–ä¸»é¢˜
            initializeThemes();
            
            // åŠ è½½å›¾ç‰‡
            await loadImages();
            
            // ç»‘å®šäº‹ä»¶
            bindEvents();
            
            console.log('âœ… åˆå§‹åŒ–å®Œæˆ');
        });

        // æ£€æŸ¥ç®¡ç†å‘˜çŠ¶æ€
        function checkAdminStatus() {
            const token = localStorage.getItem('github_token');
            const adminStatus = localStorage.getItem('admin_status');
            
            if (token && adminStatus === 'true') {
                setAdminMode(true);
            } else {
                setGuestMode();
            }
        }

        // è®¾ç½®ç®¡ç†å‘˜æ¨¡å¼
        function setAdminMode(admin) {
            isAdmin = admin;
            
            const adminElements = document.querySelectorAll('.admin-only');
            const userStatus = document.getElementById('user-status');
            
            adminElements.forEach(el => {
                el.style.display = admin ? 'block' : 'none';
            });
            
            if (admin) {
                userStatus.innerHTML = `
                    <span class="high-contrast-text font-medium">ç®¡ç†å‘˜æ¨¡å¼</span>
                    <button onclick="logout()" class="admin-btn px-4 py-2 rounded-lg">
                        <i class="fas fa-sign-out-alt mr-2"></i>é€€å‡ºç™»å½•
                    </button>
                `;
            } else {
                userStatus.innerHTML = `
                    <span class="high-contrast-text font-medium">æ¸¸å®¢æ¨¡å¼</span>
                    <button onclick="showAdminLogin()" class="theme-btn px-4 py-2 rounded-lg">
                        <i class="fas fa-sign-in-alt mr-2"></i>ç®¡ç†å‘˜ç™»å½•
                    </button>
                `;
            }
        }

        // è®¾ç½®æ¸¸å®¢æ¨¡å¼
        function setGuestMode() {
            setAdminMode(false);
        }

        // æ˜¾ç¤ºç®¡ç†å‘˜ç™»å½•
        function showAdminLogin() {
            document.getElementById('admin-login-modal').classList.remove('hidden');
        }

        // å…³é—­ç®¡ç†å‘˜ç™»å½•æ¨¡æ€æ¡†
        function closeAdminModal() {
            document.getElementById('admin-login-modal').classList.add('hidden');
            document.getElementById('github-token').value = '';
        }

        // å¤„ç†ç®¡ç†å‘˜ç™»å½•
        async function handleAdminLogin(event) {
            event.preventDefault();
            
            const token = document.getElementById('github-token').value.trim();
            if (!token) {
                alert('è¯·è¾“å…¥GitHub Token');
                return;
            }
            
            try {
                // éªŒè¯Token
                const response = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    localStorage.setItem('github_token', token);
                    localStorage.setItem('admin_status', 'true');
                    setAdminMode(true);
                    closeAdminModal();
                    alert('âœ… ç®¡ç†å‘˜ç™»å½•æˆåŠŸï¼');
                } else {
                    alert('âŒ GitHub TokenéªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥Tokenæ˜¯å¦æ­£ç¡®');
                }
            } catch (error) {
                alert('âŒ ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
                console.error('ç™»å½•å¤±è´¥:', error);
            }
        }

        // é€€å‡ºç™»å½•
        function logout() {
            localStorage.removeItem('github_token');
            localStorage.removeItem('admin_status');
            setGuestMode();
            alert('å·²é€€å‡ºç®¡ç†å‘˜æ¨¡å¼');
        }

        // åŠ è½½å›¾ç‰‡
        async function loadImages() {
            const loadingIndicator = document.getElementById('loading-indicator');
            const imagesGrid = document.getElementById('images-grid');
            const noImages = document.getElementById('no-images');
            
            loadingIndicator.style.display = 'block';
            imagesGrid.style.display = 'none';
            noImages.style.display = 'none';
            
            try {
                currentImages = await imageLoader.loadAllImages();
                
                if (currentImages.length > 0) {
                    renderImages(currentImages);
                    updateAIStatistics();
                    imagesGrid.style.display = 'grid';
                } else {
                    noImages.style.display = 'block';
                }
            } catch (error) {
                console.error('åŠ è½½å›¾ç‰‡å¤±è´¥:', error);
                noImages.style.display = 'block';
            } finally {
                loadingIndicator.style.display = 'none';
            }
        }

        // æ¸²æŸ“å›¾ç‰‡
        function renderImages(images) {
            const grid = document.getElementById('images-grid');
            grid.innerHTML = '';
            
            images.forEach((image, index) => {
                const imageCard = createImageCard(image, index);
                grid.appendChild(imageCard);
            });
        }

        // åˆ›å»ºå›¾ç‰‡å¡ç‰‡
        function createImageCard(image, index) {
            const card = document.createElement('div');
            card.className = 'image-card glass-effect rounded-xl overflow-hidden cursor-pointer';
            card.onclick = () => openImageModal(index);
            
            const analysis = aiAnalysisResults.get(image.id);
            
            card.innerHTML = `
                <div class="relative">
                    <img src="${image.url}" alt="${image.name}" 
                         class="w-full h-48 object-cover"
                         onerror="this.src='https://via.placeholder.com/400x300?text=å›¾ç‰‡åŠ è½½å¤±è´¥'">
                    
                    <!-- AIåˆ†æé¢„è§ˆ -->
                    <div class="ai-analysis-preview absolute top-2 right-2 px-3 py-1 rounded-lg text-xs">
                        <i class="fas fa-brain mr-1"></i>
                        AI: ${analysis ? Math.round(analysis.confidence * 100) : 0}%
                    </div>
                    
                    <!-- æ ‡ç­¾é¢„è§ˆ -->
                    ${analysis && analysis.smartTags.length > 0 ? `
                        <div class="absolute bottom-2 left-2 right-2">
                            <div class="flex flex-wrap gap-1">
                                ${analysis.smartTags.slice(0, 3).map(tag => `
                                    <span class="tag-item px-2 py-1 rounded text-xs">${tag}</span>
                                `).join('')}
                                ${analysis.smartTags.length > 3 ? `
                                    <span class="tag-item px-2 py-1 rounded text-xs">+${analysis.smartTags.length - 3}</span>
                                ` : ''}
                            </div>
                        </div>
                    ` : ''}
                </div>
                
                <div class="p-4">
                    <h3 class="high-contrast-text font-semibold text-lg mb-2 truncate">${image.name}</h3>
                    <div class="flex items-center justify-between text-sm">
                        <span class="high-contrast-text opacity-75">${image.loadMethod}</span>
                        <div class="flex items-center space-x-2">
                            <button onclick="event.stopPropagation(); downloadImage('${image.url}', '${image.name}')" 
                                    class="text-blue-500 hover:text-blue-700">
                                <i class="fas fa-download"></i>
                            </button>
                            <button onclick="event.stopPropagation(); shareImage('${image.id}')" 
                                    class="text-green-500 hover:text-green-700">
                                <i class="fas fa-share"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- AIåˆ†æç®€è¦ä¿¡æ¯ -->
                    ${analysis ? `
                        <div class="mt-3 pt-3 border-t border-gray-200">
                            <div class="text-xs high-contrast-text opacity-75 space-y-1">
                                ${analysis.objects.length > 0 ? `
                                    <div><i class="fas fa-eye mr-1"></i>ç‰©ä½“: ${analysis.objects[0].label}</div>
                                ` : ''}
                                ${analysis.emotions.length > 0 ? `
                                    <div><i class="fas fa-heart mr-1"></i>æƒ…æ„Ÿ: ${analysis.emotions[0].label}</div>
                                ` : ''}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
            
            return card;
        }

        // æ‰“å¼€å›¾ç‰‡æ¨¡æ€æ¡†
        function openImageModal(index) {
            currentImageIndex = index;
            const image = currentImages[index];
            const analysis = aiAnalysisResults.get(image.id);
            
            document.getElementById('modal-title').textContent = image.name;
            document.getElementById('modal-image').src = image.url;
            
            // æ˜¾ç¤ºAIåˆ†æç»“æœ
            displayModalAIAnalysis(analysis);
            
            // æ˜¾ç¤ºæ ‡ç­¾
            displayModalTags(analysis ? analysis.smartTags : []);
            
            // æ˜¾ç¤ºæè¿°
            const descriptionTextarea = document.getElementById('modal-description');
            descriptionTextarea.value = getImageDescription(image.id);
            descriptionTextarea.readOnly = !isAdmin;
            
            document.getElementById('image-detail-modal').classList.remove('hidden');
        }

        // åœ¨æ¨¡æ€æ¡†ä¸­æ˜¾ç¤ºAIåˆ†æç»“æœ
        function displayModalAIAnalysis(analysis) {
            const container = document.getElementById('modal-ai-analysis');
            
            if (!analysis) {
                container.innerHTML = '<p class="high-contrast-text opacity-75">æš‚æ— AIåˆ†æç»“æœ</p>';
                return;
            }
            
            container.innerHTML = `
                <div class="space-y-4">
                    <!-- ç½®ä¿¡åº¦ -->
                    <div class="glass-effect rounded-lg p-4">
                        <div class="flex items-center justify-between mb-2">
                            <span class="high-contrast-text font-semibold">æ•´ä½“ç½®ä¿¡åº¦</span>
                            <span class="high-contrast-text font-bold">${Math.round(analysis.confidence * 100)}%</span>
                        </div>
                        <div class="confidence-bar">
                            <div class="h-full bg-blue-500 rounded" style="width: ${analysis.confidence * 100}%"></div>
                        </div>
                    </div>
                    
                    <!-- æ£€æµ‹åˆ°çš„ç‰©ä½“ -->
                    ${analysis.objects.length > 0 ? `
                        <div class="glass-effect rounded-lg p-4">
                            <h4 class="high-contrast-text font-semibold mb-3">
                                <i class="fas fa-eye mr-2"></i>æ£€æµ‹åˆ°çš„ç‰©ä½“
                            </h4>
                            <div class="space-y-2">
                                ${analysis.objects.map(obj => `
                                    <div class="flex items-center justify-between">
                                        <span class="high-contrast-text">${obj.label}</span>
                                        <span class="text-sm high-contrast-text opacity-75">${Math.round(obj.confidence * 100)}%</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    <!-- åœºæ™¯åˆ†æ -->
                    ${analysis.scenes.length > 0 ? `
                        <div class="glass-effect rounded-lg p-4">
                            <h4 class="high-contrast-text font-semibold mb-3">
                                <i class="fas fa-landscape mr-2"></i>åœºæ™¯åˆ†æ
                            </h4>
                            <div class="space-y-2">
                                ${analysis.scenes.map(scene => `
                                    <div class="flex items-center justify-between">
                                        <span class="high-contrast-text">${scene.label}</span>
                                        <span class="text-sm high-contrast-text opacity-75">${Math.round(scene.confidence * 100)}%</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    <!-- æƒ…æ„Ÿåˆ†æ -->
                    ${analysis.emotions.length > 0 ? `
                        <div class="glass-effect rounded-lg p-4">
                            <h4 class="high-contrast-text font-semibold mb-3">
                                <i class="fas fa-heart mr-2"></i>æƒ…æ„Ÿåˆ†æ
                            </h4>
                            <div class="space-y-2">
                                ${analysis.emotions.map(emotion => `
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <div class="w-3 h-3 rounded-full mr-2" style="background: ${emotion.color}"></div>
                                            <span class="high-contrast-text">${emotion.label}</span>
                                        </div>
                                        <span class="text-sm high-contrast-text opacity-75">${Math.round(emotion.confidence * 100)}%</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    <!-- ä¸»è¦é¢œè‰² -->
                    ${analysis.colors.length > 0 ? `
                        <div class="glass-effect rounded-lg p-4">
                            <h4 class="high-contrast-text font-semibold mb-3">
                                <i class="fas fa-palette mr-2"></i>ä¸»è¦é¢œè‰²
                            </h4>
                            <div class="flex flex-wrap gap-2">
                                ${analysis.colors.map(color => `
                                    <div class="flex items-center space-x-2">
                                        <div class="w-6 h-6 rounded border border-gray-300" style="background: ${color.hex}"></div>
                                        <span class="text-sm high-contrast-text">${color.name}</span>
                                        <span class="text-xs high-contrast-text opacity-75">${color.percentage}%</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // åœ¨æ¨¡æ€æ¡†ä¸­æ˜¾ç¤ºæ ‡ç­¾
        function displayModalTags(tags) {
            const container = document.getElementById('modal-tags');
            container.innerHTML = tags.map(tag => `
                <span class="tag-item px-3 py-1 rounded-lg text-sm">${tag}</span>
            `).join('');
        }

        // å…³é—­å›¾ç‰‡æ¨¡æ€æ¡†
        function closeImageModal() {
            document.getElementById('image-detail-modal').classList.add('hidden');
        }

        // æ›´æ–°AIç»Ÿè®¡
        function updateAIStatistics() {
            let totalObjects = 0;
            let totalScenes = 0;
            let totalTags = 0;
            
            aiAnalysisResults.forEach(analysis => {
                totalObjects += analysis.objects.length;
                totalScenes += analysis.scenes.length;
                totalTags += analysis.smartTags.length;
            });
            
            document.getElementById('objects-count').textContent = totalObjects;
            document.getElementById('scenes-count').textContent = totalScenes;
            document.getElementById('tags-count').textContent = totalTags;
            
            // æ›´æ–°AIåˆ†æè¯¦æƒ…
            updateAIAnalysisDetails();
        }

        // æ›´æ–°AIåˆ†æè¯¦æƒ…
        function updateAIAnalysisDetails() {
            const container = document.getElementById('ai-analysis-details');
            
            if (aiAnalysisResults.size === 0) {
                container.innerHTML = '<p class="high-contrast-text text-center">æš‚æ— AIåˆ†ææ•°æ®</p>';
                return;
            }
            
            // æ±‡æ€»ç»Ÿè®¡
            const objectStats = {};
            const sceneStats = {};
            const emotionStats = {};
            
            aiAnalysisResults.forEach(analysis => {
                analysis.objects.forEach(obj => {
                    objectStats[obj.label] = (objectStats[obj.label] || 0) + 1;
                });
                
                analysis.scenes.forEach(scene => {
                    sceneStats[scene.label] = (sceneStats[scene.label] || 0) + 1;
                });
                
                analysis.emotions.forEach(emotion => {
                    emotionStats[emotion.label] = (emotionStats[emotion.label] || 0) + 1;
                });
            });
            
            container.innerHTML = `
                <div class="grid md:grid-cols-3 gap-6">
                    <!-- çƒ­é—¨ç‰©ä½“ -->
                    <div class="glass-effect rounded-xl p-6">
                        <h3 class="high-contrast-text text-lg font-semibold mb-4">
                            <i class="fas fa-fire mr-2"></i>çƒ­é—¨ç‰©ä½“
                        </h3>
                        <div class="space-y-2">
                            ${Object.entries(objectStats)
                                .sort(([,a], [,b]) => b - a)
                                .slice(0, 5)
                                .map(([object, count]) => `
                                    <div class="flex justify-between items-center">
                                        <span class="high-contrast-text">${object}</span>
                                        <span class="ai-badge px-2 py-1 rounded text-sm">${count}</span>
                                    </div>
                                `).join('')}
                        </div>
                    </div>
                    
                    <!-- çƒ­é—¨åœºæ™¯ -->
                    <div class="glass-effect rounded-xl p-6">
                        <h3 class="high-contrast-text text-lg font-semibold mb-4">
                            <i class="fas fa-mountain mr-2"></i>çƒ­é—¨åœºæ™¯
                        </h3>
                        <div class="space-y-2">
                            ${Object.entries(sceneStats)
                                .sort(([,a], [,b]) => b - a)
                                .slice(0, 5)
                                .map(([scene, count]) => `
                                    <div class="flex justify-between items-center">
                                        <span class="high-contrast-text">${scene}</span>
                                        <span class="ai-badge px-2 py-1 rounded text-sm">${count}</span>
                                    </div>
                                `).join('')}
                        </div>
                    </div>
                    
                    <!-- æƒ…æ„Ÿåˆ†å¸ƒ -->
                    <div class="glass-effect rounded-xl p-6">
                        <h3 class="high-contrast-text text-lg font-semibold mb-4">
                            <i class="fas fa-heart mr-2"></i>æƒ…æ„Ÿåˆ†å¸ƒ
                        </h3>
                        <div class="space-y-2">
                            ${Object.entries(emotionStats)
                                .sort(([,a], [,b]) => b - a)
                                .slice(0, 5)
                                .map(([emotion, count]) => `
                                    <div class="flex justify-between items-center">
                                        <span class="high-contrast-text">${emotion}</span>
                                        <span class="ai-badge px-2 py-1 rounded text-sm">${count}</span>
                                    </div>
                                `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        // åˆ·æ–°ç”»å»Š
        async function refreshGallery() {
            await loadImages();
        }

        // ä¸‹è½½å›¾ç‰‡
        function downloadImage(url, filename) {
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            link.click();
        }

        // åˆ†äº«å›¾ç‰‡
        function shareImage(imageId) {
            const image = currentImages.find(img => img.id === imageId);
            if (image) {
                if (navigator.share) {
                    navigator.share({
                        title: image.name,
                        url: image.url
                    });
                } else {
                    navigator.clipboard.writeText(image.url).then(() => {
                        alert('å›¾ç‰‡é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                    });
                }
            }
        }

        // ä¸‹è½½å½“å‰å›¾ç‰‡
        function downloadCurrentImage() {
            const image = currentImages[currentImageIndex];
            downloadImage(image.url, image.name);
        }

        // åˆ†äº«å½“å‰å›¾ç‰‡
        function shareCurrentImage() {
            const image = currentImages[currentImageIndex];
            shareImage(image.id);
        }

        // è·å–å›¾ç‰‡æè¿°
        function getImageDescription(imageId) {
            const descriptions = JSON.parse(localStorage.getItem('image_descriptions') || '{}');
            return descriptions[imageId] || '';
        }

        // ä¿å­˜å›¾ç‰‡æè¿°
        function saveImageDescription() {
            if (!isAdmin) return;
            
            const image = currentImages[currentImageIndex];
            const description = document.getElementById('modal-description').value;
            
            const descriptions = JSON.parse(localStorage.getItem('image_descriptions') || '{}');
            descriptions[image.id] = description;
            localStorage.setItem('image_descriptions', JSON.stringify(descriptions));
            
            alert('æè¿°å·²ä¿å­˜');
        }

        // å¤„ç†æ ‡ç­¾è¾“å…¥
        function handleTagInput(event) {
            if (event.key === 'Enter' && isAdmin) {
                const input = event.target;
                const tag = input.value.trim();
                
                if (tag) {
                    addTag(tag);
                    input.value = '';
                }
            }
        }

        // æ·»åŠ æ ‡ç­¾
        function addTag(tag) {
            if (!isAdmin) return;
            
            const image = currentImages[currentImageIndex];
            const analysis = aiAnalysisResults.get(image.id);
            
            if (analysis && !analysis.smartTags.includes(tag)) {
                analysis.smartTags.push(tag);
                displayModalTags(analysis.smartTags);
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                const customTags = JSON.parse(localStorage.getItem('custom_tags') || '{}');
                customTags[image.id] = analysis.smartTags;
                localStorage.setItem('custom_tags', JSON.stringify(customTags));
            }
        }

        // æ ‡ç­¾é¡µåˆ‡æ¢
        function showTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µ
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('admin-btn');
                btn.classList.add('theme-btn');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µ
            const targetTab = document.getElementById(tabName + '-tab');
            if (targetTab) {
                targetTab.classList.remove('hidden');
            }
            
            // æ¿€æ´»å¯¹åº”æŒ‰é’®
            event.target.classList.remove('theme-btn');
            event.target.classList.add('admin-btn');
        }

        // åˆå§‹åŒ–ä¸»é¢˜
        function initializeThemes() {
            const themeOptions = document.getElementById('theme-options');
            
            const themes = [
                { name: 'é»˜è®¤ä¸»é¢˜', bg: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' },
                { name: 'æµ·æ´‹ä¸»é¢˜', bg: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' },
                { name: 'æ£®æ—ä¸»é¢˜', bg: 'linear-gradient(135deg, #134e5e 0%, #71b280 100%)' },
                { name: 'æ—¥è½ä¸»é¢˜', bg: 'linear-gradient(135deg, #ff6b6b 0%, #feca57 50%, #ff9ff3 100%)' }
            ];
            
            themeOptions.innerHTML = themes.map((theme, index) => `
                <div class="theme-option cursor-pointer" onclick="applyTheme(${index})">
                    <div class="w-full h-16 rounded-lg mb-2" style="background: ${theme.bg}"></div>
                    <p class="high-contrast-text text-sm text-center">${theme.name}</p>
                </div>
            `).join('');
        }

        // åº”ç”¨ä¸»é¢˜
        function applyTheme(themeIndex) {
            const themes = [
                'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                'linear-gradient(135deg, #134e5e 0%, #71b280 100%)',
                'linear-gradient(135deg, #ff6b6b 0%, #feca57 50%, #ff9ff3 100%)'
            ];
            
            document.body.style.background = themes[themeIndex];
            localStorage.setItem('selected_theme', themeIndex);
        }

        // ç»‘å®šäº‹ä»¶
        function bindEvents() {
            // æœç´¢åŠŸèƒ½
            document.getElementById('search-input').addEventListener('input', function(e) {
                const query = e.target.value.toLowerCase();
                const filteredImages = currentImages.filter(image => 
                    image.name.toLowerCase().includes(query) ||
                    (aiAnalysisResults.get(image.id)?.smartTags || []).some(tag => 
                        tag.toLowerCase().includes(query)
                    )
                );
                renderImages(filteredImages);
            });
            
            // ä¸»é¢˜åˆ‡æ¢æŒ‰é’®
            document.getElementById('theme-toggle').addEventListener('click', function() {
                showTab('settings');
            });
            
            // ç®¡ç†å‘˜ç™»å½•æŒ‰é’®
            document.getElementById('admin-login-btn').addEventListener('click', showAdminLogin);
            
            // ESCé”®å…³é—­æ¨¡æ€æ¡†
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeImageModal();
                    closeAdminModal();
                }
            });
            
            // é»˜è®¤æ˜¾ç¤ºå›¾ç‰‡æµè§ˆæ ‡ç­¾é¡µ
            showTab('gallery');
        }
    </script>
</body>
</html>